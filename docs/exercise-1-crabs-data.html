<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Exercise 1: Crabs Data | STATS5099 Data Mining and Machine Learning</title>
  <meta name="description" content="2 Exercise 1: Crabs Data | STATS5099 Data Mining and Machine Learning" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Exercise 1: Crabs Data | STATS5099 Data Mining and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Exercise 1: Crabs Data | STATS5099 Data Mining and Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="exercise-2-titanic-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to DMML Lab 4</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#classification-trees"><i class="fa fa-check"></i><b>1.1</b> Classification trees</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#bagging-and-random-forests"><i class="fa fa-check"></i><b>1.2</b> Bagging and random forests</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise-1-crabs-data.html"><a href="exercise-1-crabs-data.html"><i class="fa fa-check"></i><b>2</b> Exercise 1: Crabs Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exercise-1-crabs-data.html"><a href="exercise-1-crabs-data.html#pruning"><i class="fa fa-check"></i><b>2.1</b> Pruning</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise-2-titanic-data.html"><a href="exercise-2-titanic-data.html"><i class="fa fa-check"></i><b>3</b> Exercise 2: Titanic Data</a></li>
<li class="chapter" data-level="4" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>4</b> Solution</a>
<ul>
<li class="chapter" data-level="4.1" data-path="solution.html"><a href="solution.html#exercise-1"><i class="fa fa-check"></i><b>4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.2" data-path="solution.html"><a href="solution.html#exercise-2"><i class="fa fa-check"></i><b>4.2</b> Exercise 2</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STATS5099 Data Mining and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise-1-crabs-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Exercise 1: Crabs Data<a href="exercise-1-crabs-data.html#exercise-1-crabs-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the <code>crabs</code> data example we are interested in predicting the sex of a crab based on its morphological measurements. This data is available in the <code>MASS</code> library with the following variables:</p>
<ul>
<li>sp: species - “B” or “O” for blue or orange (not used);</li>
<li>sex: as it says (the classification variable of interest);</li>
<li>index: index 1:50 within each of the four groups (not used);</li>
<li>FL: frontal lobe size (mm);</li>
<li>RW: rear width (mm);</li>
<li>CL: carapace length (mm);</li>
<li>CW: carapace width (mm);</li>
<li>BD: body depth (mm).</li>
</ul>
<p>This data can be extracted from the <code>MASS</code> library via:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="exercise-1-crabs-data.html#cb4-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb4-2"><a href="exercise-1-crabs-data.html#cb4-2" tabindex="-1"></a><span class="fu">data</span>(crabs)</span></code></pre></div>
<p>We are interested in predicting the sex of the crab based on the last 5 variables, so we create a data frame of these variables to be used.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="exercise-1-crabs-data.html#cb5-1" tabindex="-1"></a>data.crabs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(crabs[, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>)])</span></code></pre></div>
<p><strong>Task</strong></p>
<ol style="list-style-type: decimal">
<li>Split the data into training, validation and test data sets (50%, 25%, 25% for each set).</li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<p>Check Lab 3, Section 2.2.1.</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Build a classification tree on the training data and plot the tree. Note down the decision rules for each node and ensure that you understand what each of the numbers mean.</li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<p>Use the <code>rpart</code> and <code>rpart.plot</code> commands to build and visualise the classification tree.</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li><p>Print out the rules of the classification tree built in step 2. Again, you should understand what each of the numbers corresponds to.</p></li>
<li><p>Based on the plot or output of the classification tree, predict the class for the following observation.</p></li>
</ol>
<pre><code>##       FL   RW   CL   CW   BD
## 150 23.1 15.7 47.6 52.8 21.6</code></pre>
<p>You can also check the result by using the <code>predict</code> function in <code>R</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="exercise-1-crabs-data.html#cb7-1" tabindex="-1"></a><span class="fu">predict</span>(crabs.rt, <span class="at">newdata=</span>valid.crab[<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;class&quot;</span>)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>How could you determine if the classification tree is under-fitting or overfitting?</li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<ol style="list-style-type: lower-alpha">
<li><p>Which evaluation criteria may be used to assess the performance of classification tree?</p></li>
<li><p>Calculate sensitivity and specificity for training and validation sets, assuming female is the positive class and male is the negative class.</p></li>
<li><p>Based on results in (b), what's your conclusion about under-/over-fitting?</p></li>
</ol>
</div>
<div id="pruning" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Pruning<a href="exercise-1-crabs-data.html#pruning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We may also want to reduce the size of the tree (prune it) to avoid overfitting and maximising the chance of being gerenalisable to future data. We can do this using cross-validation as below. Either look at the cross-validation complexity plot or use the output of the xerror (cross-validation error) variable.</p>
<p>There are two strategies to choose the value of complexity parameter
(and the corresponding tree size). The first option is to prune the tree back to the point where the cross-validated error is a minimum, known as the <em>minimum error</em> strategy. The second option is to prune the tree using the complexity parameter of the smallest tree that is within one standard deviation of the tree with the smallest xerror, known as the <em>smallest tree</em> strategy. In the case that there are multiple trees with the same xerror; we will choose the smaller one (since that tree would predict as well as the other one but it would also have fewer branches; thus we can also avoid overfitting).</p>
<p><strong>Task</strong></p>
<ol start="6" style="list-style-type: decimal">
<li>Build a fully grown tree.</li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<p>Change the values of minsplit, minbucket, maxdepth and cp in <code>rpart.control</code>.</p>
</div>
<ol start="7" style="list-style-type: decimal">
<li>The complexity parameter (cp) table for the fitted tree can be produced by using <code>printcp</code>. Given the output from a fully grown tree, decide the appropriate cp value using both the minimum error strategy and the smallest tree strategy.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="exercise-1-crabs-data.html#cb8-1" tabindex="-1"></a><span class="fu">printcp</span>(Full_tree)</span></code></pre></div>
<pre><code>## 
## Classification tree:
## rpart(formula = sex ~ FL + RW + CL + CW + BD, data = train.crab, 
##     method = &quot;class&quot;, control = rpart.control(minsplit = 2, minbucket = 1, 
##         maxdepth = 30, cp = -1))
## 
## Variables actually used in tree construction:
## [1] BD CL FL RW
## 
## Root node error: 49/100 = 0.49
## 
## n= 100 
## 
##          CP nsplit rel error  xerror     xstd
## 1  0.265306      0  1.000000 1.28571 0.098531
## 2  0.173469      1  0.734694 0.87755 0.101036
## 3  0.051020      4  0.204082 0.53061 0.089517
## 4  0.030612      6  0.102041 0.48980 0.087160
## 5  0.020408      8  0.040816 0.48980 0.087160
## 6  0.010204      9  0.020408 0.42857 0.083124
## 7 -1.000000     11  0.000000 0.42857 0.083124</code></pre>
<p><em>For the following four questions, enter your answer by rounding to 3 decimal places</em>.</p>
<ol style="list-style-type: lower-alpha">
<li>What is the training error rate after 4 splits? <input class='webex-solveme nospaces' size='1' data-answer='["1"]'/></li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<p>The training error rate equals to <code>rel error</code> (relative training error rate) multiplied by <code>root node error</code>.</p>
</div>
<ol start="2" style="list-style-type: lower-alpha">
<li>What is the cross-validation error rate after 4 splits? <input class='webex-solveme nospaces' size='1' data-answer='["1"]'/></li>
</ol>
<div class="webex-solution">
<button>
Hint
</button>
<p>The cross-validation error rate equals to <code>xerror</code> multiplied by <code>root node error</code>.</p>
</div>
<ol start="3" style="list-style-type: lower-alpha">
<li><p>Which cp value you would choose when using the minimum error strategy? <input class='webex-solveme nospaces' size='5' data-answer='["0.011","0.012","0.013","0.014","0.015","0.016","0.017","0.018","0.019","0.02",".011",".012",".013",".014",".015",".016",".017",".018",".019",".02"]'/></p></li>
<li><p>Which cp value you would choose when using the smallest tree strategy? <input class='webex-solveme nospaces' size='5' data-answer='["0.031","0.032","0.033","0.034","0.035","0.036","0.037","0.038","0.039","0.04","0.041","0.042","0.043","0.044","0.045","0.046","0.047","0.048","0.049","0.05","0.051",".031",".032",".033",".034",".035",".036",".037",".038",".039",".04",".041",".042",".043",".044",".045",".046",".047",".048",".049",".05",".051"]'/>
<br></p></li>
</ol>
<p>We could also choose the cp value according to the cp plot. The minimum error strategy refers to the cp value which has the lowest X-val Relative Error. The smallest tree strategy refers to the largest cp value which is under the dashed line; the intercept of this line equals to the minimum xerror plus its standard deviation.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="exercise-1-crabs-data.html#cb10-1" tabindex="-1"></a><span class="fu">plotcp</span>(Full_tree)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Prune the fully grown classification tree using the cp value found from the smallest tree strategy. Calculate sensitivity and specificity for training and validation sets again and compare to the results in Task 5.</li>
</ol>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise-2-titanic-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
