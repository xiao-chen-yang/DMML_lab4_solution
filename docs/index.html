<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>STATS5099 Data Mining and Machine Learning</title>
  <meta name="description" content="STATS5099 Data Mining and Machine Learning" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="STATS5099 Data Mining and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="STATS5099 Data Mining and Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="exercise-1-crabs-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to DMML Lab 4</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#classification-trees"><i class="fa fa-check"></i><b>1.1</b> Classification trees</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#pruning"><i class="fa fa-check"></i><b>1.2</b> Pruning</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#bagging-and-random-forests"><i class="fa fa-check"></i><b>1.3</b> Bagging and random forests</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise-1-crabs-data.html"><a href="exercise-1-crabs-data.html"><i class="fa fa-check"></i><b>2</b> Exercise 1: Crabs Data</a></li>
<li class="chapter" data-level="3" data-path="exercise-2-titanic-data.html"><a href="exercise-2-titanic-data.html"><i class="fa fa-check"></i><b>3</b> Exercise 2: Titanic Data</a></li>
<li class="chapter" data-level="4" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>4</b> Solution</a>
<ul>
<li class="chapter" data-level="4.1" data-path="solution.html"><a href="solution.html#exercise-1"><i class="fa fa-check"></i><b>4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.2" data-path="solution.html"><a href="solution.html#exercise-2"><i class="fa fa-check"></i><b>4.2</b> Exercise 2</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STATS5099 Data Mining and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">STATS5099 Data Mining and Machine Learning</h1>
</div>
<div id="welcome-to-dmml-lab-4" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Welcome to DMML Lab 4<a href="index.html#welcome-to-dmml-lab-4" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In week 4, we have studied three tree-based methods, namely classification trees, bagging and random forests.</p>
<div id="classification-trees" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Classification trees<a href="index.html#classification-trees" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Classification trees can be implemented by using the <code>rpart</code> and <code>rpart.plot</code> packages. Some key codes are summarised below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="index.html#cb1-1" tabindex="-1"></a><span class="fu">library</span>(rpart); <span class="fu">library</span>(rpart.plot)</span>
<span id="cb1-2"><a href="index.html#cb1-2" tabindex="-1"></a><span class="co"># build a tree for dataset &#39;Data&#39; with features &#39;X1&#39;, &#39;X2&#39; etc and class label &#39;Y&#39;</span></span>
<span id="cb1-3"><a href="index.html#cb1-3" tabindex="-1"></a>Model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>..., <span class="at">data=</span>Data, <span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb1-4"><a href="index.html#cb1-4" tabindex="-1"></a>Model</span>
<span id="cb1-5"><a href="index.html#cb1-5" tabindex="-1"></a><span class="co"># visualise the tree</span></span>
<span id="cb1-6"><a href="index.html#cb1-6" tabindex="-1"></a><span class="fu">rpart.plot</span>(Model, <span class="at">type=</span><span class="dv">2</span>, <span class="at">extra=</span><span class="dv">4</span>) <span class="co">#check help page for more options about type and extra</span></span>
<span id="cb1-7"><a href="index.html#cb1-7" tabindex="-1"></a><span class="co"># make predictions for new data with features &#39;Xnew&#39;</span></span>
<span id="cb1-8"><a href="index.html#cb1-8" tabindex="-1"></a>Ynew.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(Model, <span class="at">newdata=</span>Xnew, <span class="at">type=</span><span class="st">&quot;class&quot;</span>)</span></code></pre></div>
<p>One thing to be cautious when building the tree (or any classifier) is to avoid overfitting. This can be achieved by setting stopping criteria to prevent tree from growing, using arguments as listed below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="index.html#cb2-1" tabindex="-1"></a><span class="co"># set stopping criteria via &#39;control&#39;: smaller values of minsplit, minbucket and cp</span></span>
<span id="cb2-2"><a href="index.html#cb2-2" tabindex="-1"></a><span class="co"># and larger value of maxdepth lead to a larger tree</span></span>
<span id="cb2-3"><a href="index.html#cb2-3" tabindex="-1"></a>Model2 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>..., <span class="at">data=</span>Data, <span class="at">method=</span><span class="st">&quot;class&quot;</span>,</span>
<span id="cb2-4"><a href="index.html#cb2-4" tabindex="-1"></a>                <span class="at">control=</span><span class="fu">rpart.control</span>(<span class="at">minsplit=</span><span class="dv">20</span>, <span class="at">minbucket=</span><span class="fu">round</span>(minsplit<span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb2-5"><a href="index.html#cb2-5" tabindex="-1"></a>                                      <span class="at">maxdepth =</span> <span class="dv">30</span>, <span class="at">cp=</span><span class="fl">0.01</span>))</span>
<span id="cb2-6"><a href="index.html#cb2-6" tabindex="-1"></a>                                      <span class="co">#values are set as default</span></span></code></pre></div>
</div>
<div id="pruning" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Pruning<a href="index.html#pruning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An alternative approach to avoid overfitting is by pruning. The idea of pruning is to first build a very large tree and then remove subtrees that carry less information. To determine how much of the tree should be pruned, we need to decide the appropriate value of cost complexity, which can be found by either looking at the cross-validation cost complexity plot or using the output of the xerror (cross-validation error) variable.</p>
<p>The <code>R</code> commands for producing the cross-validation cost complexity plot or table are listed below:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="index.html#cb3-1" tabindex="-1"></a><span class="fu">plotcp</span>(Model)</span>
<span id="cb3-2"><a href="index.html#cb3-2" tabindex="-1"></a><span class="fu">printcp</span>(Model)</span></code></pre></div>
<p><strong>QUESTION</strong>: (Lecture note, task 3) For the fully grown tree printed below, compute:</p>
<ul>
<li><p>the cross validation error rate when there are 9 splits in that tree;</p></li>
<li><p>the training data error rate when we do not have to prune the tree at all (i.e. after 178 splits).</p></li>
</ul>
<pre><code>## 
## Classification tree:
## rpart(formula = Creditability ~ Age + Length_of_cur_employment + 
##     Purpose, data = train, method = &quot;class&quot;, parms = list(split = &quot;information&quot;), 
##     cp = -1, minsplit = 2, minbucket = 1)
## 
## Variables actually used in tree construction:
## [1] Age                      Length_of_cur_employment Purpose                 
## 
## Root node error: 143/500 = 0.286
## 
## n= 500 
## 
##            CP nsplit rel error  xerror     xstd
## 1   0.0244755      0   1.00000 1.00000 0.070661
## 2   0.0139860      2   0.95105 0.99301 0.070512
## 3   0.0069930      3   0.93706 1.01399 0.070954
## 4   0.0052448      9   0.89510 1.13287 0.073180
## 5   0.0046620     17   0.85315 1.19580 0.074178
## 6   0.0043706     44   0.69930 1.18182 0.073967
## 7   0.0034965     52   0.66434 1.18182 0.073967
## 8   0.0031080     66   0.61538 1.23776 0.074777
## 9   0.0027972     81   0.56643 1.23776 0.074777
## 10  0.0026224     86   0.55245 1.23776 0.074777
## 11  0.0023310     94   0.53147 1.32867 0.075899
## 12  0.0021517    103   0.51049 1.31469 0.075742
## 13  0.0017483    120   0.46853 1.31469 0.075742
## 14  0.0013986    124   0.46154 1.31469 0.075742
## 15  0.0000000    129   0.45455 1.31469 0.075742
## 16 -1.0000000    178   0.45455 1.31469 0.075742</code></pre>
<p><img src="main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>There are two strategies to choose the value of complexity parameter (and the corresponding tree size). The first option is to prune the tree back to the point where the cross-validated error is a minimum, known as the <em>minimum error</em> strategy. The second option is to prune the tree using the complexity parameter of the smallest tree that is within one standard deviation of the tree with the smallest xerror, known as the <em>smallest tree</em> strategy. In the case that there are multiple trees with the same xerror; we will choose the smaller one (since that tree would predict as well as the other one but it would also have fewer branches; thus we can also avoid overfitting).</p>
</div>
<div id="bagging-and-random-forests" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Bagging and random forests<a href="index.html#bagging-and-random-forests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Bagging and random forests can be both implemented by using the <code>randomForest</code> function from the <code>randomForest</code> package. The difference is that in bagging, all features are used to build the tree for each bootstrapped sample, whereas in random forests, only a subset of features are used (set as the square root of all features by default).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="index.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb5-2"><a href="index.html#cb5-2" tabindex="-1"></a><span class="co"># bagging</span></span>
<span id="cb5-3"><a href="index.html#cb5-3" tabindex="-1"></a>Model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Y<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>..., <span class="at">data=</span>Data, <span class="at">mtry=</span>n_feature) <span class="co">#n_feature is the number of features in the data</span></span>
<span id="cb5-4"><a href="index.html#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="index.html#cb5-5" tabindex="-1"></a><span class="co"># random forests</span></span>
<span id="cb5-6"><a href="index.html#cb5-6" tabindex="-1"></a>Model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Y<span class="sc">~</span>X1<span class="sc">+</span>X2<span class="sc">+</span>..., <span class="at">data=</span>Data)</span></code></pre></div>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>

<a href="exercise-1-crabs-data.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
