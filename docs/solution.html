<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Solution | STATS5099 Data Mining and Machine Learning</title>
  <meta name="description" content="4 Solution | STATS5099 Data Mining and Machine Learning" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Solution | STATS5099 Data Mining and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Solution | STATS5099 Data Mining and Machine Learning" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercise-2-titanic-data.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to DMML Lab 4</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#classification-trees"><i class="fa fa-check"></i><b>1.1</b> Classification trees</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#bagging-and-random-forests"><i class="fa fa-check"></i><b>1.2</b> Bagging and random forests</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise-1-crabs-data.html"><a href="exercise-1-crabs-data.html"><i class="fa fa-check"></i><b>2</b> Exercise 1: Crabs Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exercise-1-crabs-data.html"><a href="exercise-1-crabs-data.html#pruning"><i class="fa fa-check"></i><b>2.1</b> Pruning</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise-2-titanic-data.html"><a href="exercise-2-titanic-data.html"><i class="fa fa-check"></i><b>3</b> Exercise 2: Titanic Data</a></li>
<li class="chapter" data-level="4" data-path="solution.html"><a href="solution.html"><i class="fa fa-check"></i><b>4</b> Solution</a>
<ul>
<li class="chapter" data-level="4.1" data-path="solution.html"><a href="solution.html#exercise-1"><i class="fa fa-check"></i><b>4.1</b> Exercise 1</a></li>
<li class="chapter" data-level="4.2" data-path="solution.html"><a href="solution.html#exercise-2"><i class="fa fa-check"></i><b>4.2</b> Exercise 2</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STATS5099 Data Mining and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="solution" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Solution<a href="solution.html#solution" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="exercise-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Exercise 1<a href="solution.html#exercise-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Task 1</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="solution.html#cb12-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb12-2"><a href="solution.html#cb12-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(crabs)</span>
<span id="cb12-3"><a href="solution.html#cb12-3" tabindex="-1"></a>ind1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n), <span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb12-4"><a href="solution.html#cb12-4" tabindex="-1"></a>ind2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n)[<span class="sc">-</span>ind1], <span class="fu">round</span>(n<span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb12-5"><a href="solution.html#cb12-5" tabindex="-1"></a>ind3 <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n),<span class="fu">c</span>(ind1,ind2))</span>
<span id="cb12-6"><a href="solution.html#cb12-6" tabindex="-1"></a>train.crab <span class="ot">&lt;-</span> data.crabs[ind1, ]</span>
<span id="cb12-7"><a href="solution.html#cb12-7" tabindex="-1"></a>valid.crab <span class="ot">&lt;-</span> data.crabs[ind2, ]</span>
<span id="cb12-8"><a href="solution.html#cb12-8" tabindex="-1"></a>test.crab  <span class="ot">&lt;-</span> data.crabs[ind2, ]</span></code></pre></div>
<p>Task 2</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="solution.html#cb13-1" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb13-2"><a href="solution.html#cb13-2" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb13-3"><a href="solution.html#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="solution.html#cb13-4" tabindex="-1"></a>crabs.rt <span class="ot">&lt;-</span> <span class="fu">rpart</span>(sex<span class="sc">~</span>FL <span class="sc">+</span> RW <span class="sc">+</span>  CL  <span class="sc">+</span> CW <span class="sc">+</span> BD, <span class="at">data=</span>train.crab, <span class="at">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb13-5"><a href="solution.html#cb13-5" tabindex="-1"></a><span class="fu">rpart.plot</span>(crabs.rt,<span class="at">type=</span><span class="dv">2</span>,<span class="at">extra=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-20-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Task 3</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="solution.html#cb14-1" tabindex="-1"></a>crabs.rt</span></code></pre></div>
<pre><code>## n= 100 
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
##  1) root 100 49 M (0.49000000 0.51000000)  
##    2) RW&gt;=15.9 15  1 F (0.93333333 0.06666667) *
##    3) RW&lt; 15.9 85 35 M (0.41176471 0.58823529)  
##      6) CL&lt; 35.65 65 30 F (0.53846154 0.46153846)  
##       12) RW&gt;=12.75 17  0 F (1.00000000 0.00000000) *
##       13) RW&lt; 12.75 48 18 M (0.37500000 0.62500000)  
##         26) BD&lt; 11.95 27  9 F (0.66666667 0.33333333) *
##         27) BD&gt;=11.95 21  0 M (0.00000000 1.00000000) *
##      7) CL&gt;=35.65 20  0 M (0.00000000 1.00000000) *</code></pre>
<p>Task 5</p>
<p>To check if our model is overfitting, we could compare the classification performance on training and validation sets.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="solution.html#cb16-1" tabindex="-1"></a><span class="co"># training performance</span></span>
<span id="cb16-2"><a href="solution.html#cb16-2" tabindex="-1"></a>train.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(crabs.rt, <span class="at">newdata=</span>train.crab[,<span class="sc">-</span><span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb16-3"><a href="solution.html#cb16-3" tabindex="-1"></a><span class="fu">table</span>(train.crab[,<span class="dv">1</span>], train.pred)</span></code></pre></div>
<pre><code>##    train.pred
##      F  M
##   F 49  0
##   M 10 41</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="solution.html#cb18-1" tabindex="-1"></a><span class="co"># validation performance</span></span>
<span id="cb18-2"><a href="solution.html#cb18-2" tabindex="-1"></a>valid.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(crabs.rt, <span class="at">newdata=</span>valid.crab[,<span class="sc">-</span><span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb18-3"><a href="solution.html#cb18-3" tabindex="-1"></a><span class="fu">table</span>(valid.crab[,<span class="dv">1</span>], valid.pred)</span></code></pre></div>
<pre><code>##    valid.pred
##      F  M
##   F 20  3
##   M 10 17</code></pre>
<ol style="list-style-type: lower-alpha">
<li><p>Given this is a two-class classification problem, all evaluation measures introduced in Week 3 can be applied. In addition, considering that there are more female crabs being misclassified as male in the training data (<span class="math inline">\(9\)</span> for F-&gt;M against <span class="math inline">\(1\)</span> for M-&gt;F), it is preferable to use some measures such as class-specific correct classification rate, sensitivity and specificity, AUC to reflect this issue.</p></li>
<li></li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="solution.html#cb20-1" tabindex="-1"></a>train.table <span class="ot">&lt;-</span> <span class="fu">table</span>(train.crab[,<span class="dv">1</span>], train.pred)</span>
<span id="cb20-2"><a href="solution.html#cb20-2" tabindex="-1"></a>train.table[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(train.table[<span class="dv">1</span>,]) <span class="co"># training sensitivity</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="solution.html#cb22-1" tabindex="-1"></a>train.table[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sum</span>(train.table[<span class="dv">2</span>,]) <span class="co"># training specificity</span></span></code></pre></div>
<pre><code>## [1] 0.8039216</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="solution.html#cb24-1" tabindex="-1"></a>valid.table <span class="ot">&lt;-</span> <span class="fu">table</span>(valid.crab[,<span class="dv">1</span>], valid.pred)</span>
<span id="cb24-2"><a href="solution.html#cb24-2" tabindex="-1"></a>valid.table[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(valid.table[<span class="dv">1</span>,]) <span class="co"># validation sensitivity</span></span></code></pre></div>
<pre><code>## [1] 0.8695652</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="solution.html#cb26-1" tabindex="-1"></a>valid.table[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sum</span>(valid.table[<span class="dv">2</span>,]) <span class="co"># validation specificity</span></span></code></pre></div>
<pre><code>## [1] 0.6296296</code></pre>
<ol start="3" style="list-style-type: lower-alpha">
<li>The training and validation sensitivity are roughly the same, while validation specificity is lower than training specificity. This could be an indication of overfitting.</li>
</ol>
<p>Task 6</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="solution.html#cb28-1" tabindex="-1"></a>Full_tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(sex<span class="sc">~</span>FL <span class="sc">+</span> RW <span class="sc">+</span>  CL  <span class="sc">+</span> CW <span class="sc">+</span> BD, <span class="at">data=</span>train.crab, <span class="at">method=</span><span class="st">&quot;class&quot;</span>,</span>
<span id="cb28-2"><a href="solution.html#cb28-2" tabindex="-1"></a>                   <span class="at">control=</span><span class="fu">rpart.control</span>(<span class="at">minsplit=</span><span class="dv">2</span>,<span class="at">minbucket=</span><span class="dv">1</span>,<span class="at">maxdepth=</span><span class="dv">30</span>,<span class="at">cp=</span><span class="sc">-</span><span class="dv">1</span>))</span></code></pre></div>
<p>Task 7</p>
<ol style="list-style-type: lower-alpha">
<li><p>0.204082*0.49</p></li>
<li><p>0.53061*0.49</p></li>
<li><p>Here the lowest xerror is 0.42857 with xstd 0.083124. So, when using the minimum error strategy, we would choose the cp value which is larger than the one from Tree 6 and smaller than Tree 5, i.e. between 0.011 and 0.020.</p></li>
<li><p>When using the smallest tree strategy, we would choose the cp value from the smallest tree whose xerror is smaller than 0.511694 (0.42857+0.083124). This corresponds to Tree 4, suggesting us to use a cp value between 0.031 and 0.051.</p></li>
</ol>
<p>Task 8</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="solution.html#cb29-1" tabindex="-1"></a><span class="co"># prune the tree</span></span>
<span id="cb29-2"><a href="solution.html#cb29-2" tabindex="-1"></a>crabs.rt.pruned <span class="ot">&lt;-</span> <span class="fu">prune</span>(Full_tree, <span class="at">cp=</span><span class="fl">0.04</span>)</span>
<span id="cb29-3"><a href="solution.html#cb29-3" tabindex="-1"></a><span class="fu">rpart.plot</span>(crabs.rt.pruned)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-25-1.png" width="80%" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="solution.html#cb30-1" tabindex="-1"></a><span class="co"># training performance</span></span>
<span id="cb30-2"><a href="solution.html#cb30-2" tabindex="-1"></a>train.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(crabs.rt, <span class="at">newdata=</span>train.crab[,<span class="sc">-</span><span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb30-3"><a href="solution.html#cb30-3" tabindex="-1"></a>train.table <span class="ot">&lt;-</span> <span class="fu">table</span>(train.crab[,<span class="dv">1</span>], train.pred)</span>
<span id="cb30-4"><a href="solution.html#cb30-4" tabindex="-1"></a>train.table</span></code></pre></div>
<pre><code>##    train.pred
##      F  M
##   F 49  0
##   M 10 41</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="solution.html#cb32-1" tabindex="-1"></a>train.table[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(train.table[<span class="dv">1</span>,]) <span class="co"># training sensitivity</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="solution.html#cb34-1" tabindex="-1"></a>train.table[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sum</span>(train.table[<span class="dv">2</span>,]) <span class="co"># training specificity</span></span></code></pre></div>
<pre><code>## [1] 0.8039216</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="solution.html#cb36-1" tabindex="-1"></a><span class="co"># validation performance</span></span>
<span id="cb36-2"><a href="solution.html#cb36-2" tabindex="-1"></a>valid.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(crabs.rt, <span class="at">newdata=</span>valid.crab[,<span class="sc">-</span><span class="dv">1</span>],<span class="at">type=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb36-3"><a href="solution.html#cb36-3" tabindex="-1"></a>valid.table <span class="ot">&lt;-</span> <span class="fu">table</span>(valid.crab[,<span class="dv">1</span>], valid.pred)</span>
<span id="cb36-4"><a href="solution.html#cb36-4" tabindex="-1"></a>valid.table</span></code></pre></div>
<pre><code>##    valid.pred
##      F  M
##   F 20  3
##   M 10 17</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="solution.html#cb38-1" tabindex="-1"></a>valid.table[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span><span class="fu">sum</span>(valid.table[<span class="dv">1</span>,]) <span class="co"># validation sensitivity</span></span></code></pre></div>
<pre><code>## [1] 0.8695652</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="solution.html#cb40-1" tabindex="-1"></a>valid.table[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sum</span>(valid.table[<span class="dv">2</span>,]) <span class="co"># validation specificity</span></span></code></pre></div>
<pre><code>## [1] 0.6296296</code></pre>
<p>While pruning strategy is used, the pruned tree appears more complicated than the previous tree. Therefore, there is a strong sign of over-fitting.</p>
</div>
<div id="exercise-2" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Exercise 2<a href="solution.html#exercise-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Task 1</p>
<p>Let's use <code>str</code> first:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="solution.html#cb42-1" tabindex="-1"></a><span class="fu">library</span>(titanic)</span>
<span id="cb42-2"><a href="solution.html#cb42-2" tabindex="-1"></a><span class="fu">str</span>(titanic_train)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    891 obs. of  12 variables:
##  $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Survived   : int  0 1 1 1 0 0 0 0 1 1 ...
##  $ Pclass     : int  3 1 3 1 3 3 1 3 3 2 ...
##  $ Name       : chr  &quot;Braund, Mr. Owen Harris&quot; &quot;Cumings, Mrs. John Bradley (Florence Briggs Thayer)&quot; &quot;Heikkinen, Miss. Laina&quot; &quot;Futrelle, Mrs. Jacques Heath (Lily May Peel)&quot; ...
##  $ Sex        : chr  &quot;male&quot; &quot;female&quot; &quot;female&quot; &quot;female&quot; ...
##  $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...
##  $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...
##  $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...
##  $ Ticket     : chr  &quot;A/5 21171&quot; &quot;PC 17599&quot; &quot;STON/O2. 3101282&quot; &quot;113803&quot; ...
##  $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
##  $ Cabin      : chr  &quot;&quot; &quot;C85&quot; &quot;&quot; &quot;C123&quot; ...
##  $ Embarked   : chr  &quot;S&quot; &quot;C&quot; &quot;S&quot; &quot;S&quot; ...</code></pre>
<p>We shouldn't be happy with some of the variable types, especially when we would have to use some of them for our analysis later on. For example, Name and Ticket are unique identifiers of each passenger, thus providing no predictive power; Fare and Cabin might be redundant given PClass. In addition, for our analysis, we should transform the variables <code>Survived</code>, <code>Pclass</code>and <code>Sex</code> into factors.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="solution.html#cb44-1" tabindex="-1"></a>train <span class="ot">&lt;-</span> titanic_train[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)]</span>
<span id="cb44-2"><a href="solution.html#cb44-2" tabindex="-1"></a>train<span class="sc">$</span>Survived <span class="ot">&lt;-</span> <span class="fu">factor</span>(train<span class="sc">$</span>Survived, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Died&quot;</span>,<span class="st">&quot;Survived&quot;</span>))</span>
<span id="cb44-3"><a href="solution.html#cb44-3" tabindex="-1"></a>train<span class="sc">$</span>Pclass <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>Pclass)</span>
<span id="cb44-4"><a href="solution.html#cb44-4" tabindex="-1"></a>train<span class="sc">$</span>Sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(train<span class="sc">$</span>Sex)</span></code></pre></div>
<p>Let's start with some exploratory analysis of the data set:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="solution.html#cb45-1" tabindex="-1"></a><span class="fu">library</span>(skimr);<span class="fu">library</span>(tibble)</span>
<span id="cb45-2"><a href="solution.html#cb45-2" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb45-3"><a href="solution.html#cb45-3" tabindex="-1"></a>my_skim <span class="ot">&lt;-</span> <span class="fu">skim_with</span>(<span class="at">base=</span><span class="fu">sfl</span>(<span class="at">n=</span>length,<span class="at">n_missing=</span>n_missing),<span class="at">factor=</span><span class="fu">sfl</span>(<span class="at">ordered=</span><span class="cn">NULL</span>),</span>
<span id="cb45-4"><a href="solution.html#cb45-4" tabindex="-1"></a>                     <span class="at">numeric=</span><span class="fu">sfl</span>(<span class="at">p0=</span><span class="cn">NULL</span>,<span class="at">p100=</span><span class="cn">NULL</span>,<span class="at">hist =</span> <span class="cn">NULL</span>))</span>
<span id="cb45-5"><a href="solution.html#cb45-5" tabindex="-1"></a><span class="fu">knit_print</span>(<span class="fu">my_skim</span>(titanic))</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-28">Table 4.1: </span>Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
titanic
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
891
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Survived
</td>
<td style="text-align:right;">
891
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Die: 549, Sur: 342
</td>
</tr>
<tr>
<td style="text-align:left;">
Pclass
</td>
<td style="text-align:right;">
891
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
3: 491, 1: 216, 2: 184
</td>
</tr>
<tr>
<td style="text-align:left;">
Sex
</td>
<td style="text-align:right;">
891
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
mal: 577, fem: 314
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Age
</td>
<td style="text-align:right;">
891
</td>
<td style="text-align:right;">
177
</td>
<td style="text-align:right;">
29.70
</td>
<td style="text-align:right;">
14.53
</td>
<td style="text-align:right;">
20.12
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
38
</td>
</tr>
<tr>
<td style="text-align:left;">
SibSp
</td>
<td style="text-align:right;">
891
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
1.10
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Note that almost 20% of our data set has missing values in the variable <code>Age</code>.</p>
<p>Let's also have a look at the relationship between survival and the passenger's class.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="solution.html#cb46-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb46-2"><a href="solution.html#cb46-2" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(Pclass, <span class="at">fill=</span>Survived)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb46-3"><a href="solution.html#cb46-3" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Passenger Class&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Number of Passengers&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="solution.html#cb46-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Survival by Passenger Class&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="solution.html#cb46-5" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Died&quot;</span>, <span class="st">&quot;Survived&quot;</span>)) <span class="sc">+</span></span>
<span id="cb46-6"><a href="solution.html#cb46-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-29-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>It seems that passengers who were on the first class had a higher probability of surviving compared to the other classes (especially the 3rd one). Since we are a bit curious about this, let's be a bit more specific and find the specific probabilities using R.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="solution.html#cb47-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(train<span class="sc">$</span>Survived,train<span class="sc">$</span>Pclass),<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##           
##                    1         2         3
##   Died     0.3703704 0.5271739 0.7576375
##   Survived 0.6296296 0.4728261 0.2423625</code></pre>
<p>It seems that the probability of surviving as a first class passenger is more than twice the probability of surviving as a third class passenger (i.e. <span class="math inline">\(63\%\)</span> versus <span class="math inline">\(24\%\)</span>). Not a coincidence that the character Di Caprio played in Titanic, a third class passenger named Jack Dawson, did not survive the accident.</p>
<p>Task 2</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="solution.html#cb49-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb49-2"><a href="solution.html#cb49-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(titanic_train)</span>
<span id="cb49-3"><a href="solution.html#cb49-3" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="fu">round</span>(<span class="fl">0.2</span><span class="sc">*</span>n))</span>
<span id="cb49-4"><a href="solution.html#cb49-4" tabindex="-1"></a>val <span class="ot">&lt;-</span> train[idx,]</span>
<span id="cb49-5"><a href="solution.html#cb49-5" tabindex="-1"></a>train <span class="ot">&lt;-</span> train[<span class="sc">-</span>idx,]</span></code></pre></div>
<p>Task 3</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="solution.html#cb50-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb50-2"><a href="solution.html#cb50-2" tabindex="-1"></a>bagging <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Survived<span class="sc">~</span>Pclass<span class="sc">+</span>Age<span class="sc">+</span>Sex<span class="sc">+</span>SibSp, <span class="at">data=</span>train.imputed,</span>
<span id="cb50-3"><a href="solution.html#cb50-3" tabindex="-1"></a>                        <span class="at">mtry=</span><span class="dv">4</span>, <span class="at">ntree=</span><span class="dv">200</span>)</span>
<span id="cb50-4"><a href="solution.html#cb50-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb50-5"><a href="solution.html#cb50-5" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Survived<span class="sc">~</span>Pclass<span class="sc">+</span>Age<span class="sc">+</span>Sex<span class="sc">+</span>SibSp, <span class="at">data=</span>train.imputed,</span>
<span id="cb50-6"><a href="solution.html#cb50-6" tabindex="-1"></a>                   <span class="at">ntree=</span><span class="dv">200</span>)</span></code></pre></div>
<p>To decide whether to use bagging or random forest, one way is to look at the out-of-bag estimate of error rate, which can be found by printing out the model output (i.e. type <code>bagging</code> and <code>rf</code> directly in <code>R</code>). However, as the class is imbalanced (i.e. the number of observations in each class is different), accuracy may not be the optimal evaluation measure. Here we will use AUC instead.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="solution.html#cb51-1" tabindex="-1"></a>val.imputed <span class="ot">&lt;-</span> <span class="fu">na.roughfix</span>(val)</span>
<span id="cb51-2"><a href="solution.html#cb51-2" tabindex="-1"></a>bagging_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(bagging, val.imputed, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)</span>
<span id="cb51-3"><a href="solution.html#cb51-3" tabindex="-1"></a>rf_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf, val.imputed, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)</span>
<span id="cb51-4"><a href="solution.html#cb51-4" tabindex="-1"></a></span>
<span id="cb51-5"><a href="solution.html#cb51-5" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb51-6"><a href="solution.html#cb51-6" tabindex="-1"></a>bagging_pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(bagging_prob[,<span class="dv">2</span>], val<span class="sc">$</span>Survived)</span>
<span id="cb51-7"><a href="solution.html#cb51-7" tabindex="-1"></a>bagging_AUC  <span class="ot">&lt;-</span> <span class="fu">performance</span>(bagging_pred, <span class="st">&quot;auc&quot;</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb51-8"><a href="solution.html#cb51-8" tabindex="-1"></a>rf_pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(rf_prob[,<span class="dv">2</span>], val<span class="sc">$</span>Survived)</span>
<span id="cb51-9"><a href="solution.html#cb51-9" tabindex="-1"></a>rf_AUC  <span class="ot">&lt;-</span> <span class="fu">performance</span>(rf_pred, <span class="st">&quot;auc&quot;</span>)<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb51-10"><a href="solution.html#cb51-10" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(bagging_AUC,rf_AUC))</span></code></pre></div>
<pre><code>## [1] 0.8544942 0.8840409</code></pre>
<p>It turns out random forest achieves the highest AUC.
<br></p>
<p>Task 4. Below is an example of visualising variable importance of random forest.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="solution.html#cb53-1" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf, <span class="at">main=</span><span class="st">&quot;Predicting survival in Titanic data&quot;</span>)</span></code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-35-1.png" width="336" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="solution.html#cb54-1" tabindex="-1"></a><span class="co"># ggplot for variable importance</span></span>
<span id="cb54-2"><a href="solution.html#cb54-2" tabindex="-1"></a><span class="co"># library(forcats);library(caret);library(dplyr)</span></span>
<span id="cb54-3"><a href="solution.html#cb54-3" tabindex="-1"></a><span class="co"># rf_df &lt;- data_frame(var = rownames(randomForest::importance(rf)),</span></span>
<span id="cb54-4"><a href="solution.html#cb54-4" tabindex="-1"></a><span class="co">#                     MeanDecreaseGini = randomForest::importance(rf)[,1]) %&gt;%</span></span>
<span id="cb54-5"><a href="solution.html#cb54-5" tabindex="-1"></a><span class="co">#   mutate(var = fct_reorder(var, MeanDecreaseGini, median))</span></span>
<span id="cb54-6"><a href="solution.html#cb54-6" tabindex="-1"></a><span class="co"># rf_ggplot &lt;- ggplot(rf_df,aes(var, MeanDecreaseGini)) +</span></span>
<span id="cb54-7"><a href="solution.html#cb54-7" tabindex="-1"></a><span class="co">#   geom_point() + coord_flip() +</span></span>
<span id="cb54-8"><a href="solution.html#cb54-8" tabindex="-1"></a><span class="co">#   labs(title = &quot;Predicting survival in Titanic data&quot;,</span></span>
<span id="cb54-9"><a href="solution.html#cb54-9" tabindex="-1"></a><span class="co">#        x = NULL,y = &quot;Average decrease in the Gini Index&quot;) +</span></span>
<span id="cb54-10"><a href="solution.html#cb54-10" tabindex="-1"></a><span class="co">#   theme(plot.title = element_text(hjust = 0.5))</span></span>
<span id="cb54-11"><a href="solution.html#cb54-11" tabindex="-1"></a><span class="co"># rf_ggplot</span></span></code></pre></div>
<p>According to the random forest model, sex is the most important factor, followed by age and passenger. The number of siblings or spouses have little importance in survival.</p>
<p>Task 5</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="solution.html#cb55-1" tabindex="-1"></a>test  <span class="ot">&lt;-</span> titanic_test[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)]</span>
<span id="cb55-2"><a href="solution.html#cb55-2" tabindex="-1"></a>test<span class="sc">$</span>Pclass <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>Pclass)</span>
<span id="cb55-3"><a href="solution.html#cb55-3" tabindex="-1"></a>test<span class="sc">$</span>Sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test<span class="sc">$</span>Sex)</span>
<span id="cb55-4"><a href="solution.html#cb55-4" tabindex="-1"></a>test.imputed <span class="ot">&lt;-</span> <span class="fu">na.roughfix</span>(test)</span>
<span id="cb55-5"><a href="solution.html#cb55-5" tabindex="-1"></a>test.rf <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf, test.imputed, <span class="at">type=</span><span class="st">&quot;class&quot;</span>)</span></code></pre></div>
<p>The data set comes from the <a href="https://www.kaggle.com/c/titanic/data">Kaggle competition</a>, which does not provide the test labels to the public. Therefore we cannot further evaluate the test performance.</p>
<!-- For more analysis on this data set, have a look at: [Predicting Titanic survival using trees and random forests (among other techniques)](https://www.kaggle.com/thilakshasilva/predicting-titanic-survival-using-five-algorithms) -->

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;
    
    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");
  
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");
  
  var cl = this.classList
  
  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  
  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }
  
  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }
  
  update_total_correct();
}

window.onload = function() {
  console.log("onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }
  
  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-2-titanic-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["main.pdf", "main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
